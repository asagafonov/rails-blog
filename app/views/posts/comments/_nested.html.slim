.position-relative(data-controller="nested-comment" data-nested-comment-visible="false")
  - if indent > 1
    = image_tag('nested_comment_arrow.png', class: 'position-absolute nested_comment_button w_20')
  .card-header.px-4 = "#{t("comments.author")}: #{comment.user.email}"
  .card-body.d-flex.p-4
    p.mb-2 = comment.content
  hr

  - if user_signed_in?
    .d-flex.px-4.pb-3
      button.btn.btn-outline-secondary.me-2(data-action="nested-comment#show" data-nested-comment-target="button") = t('comments.respond')

      - if comment.user == current_user
        = link_to t('comments.delete'), comment_url(comment), data: { 'turbo-method': :delete, 'turbo-confirm': t('comments.confirm_deletion') }, class: 'me-4 btn btn-outline-danger'

    .mx-4(data-nested-comment-target="form" style="display: none;")
      == render 'posts/comments/form', comment: @comment, url: post_comments_path(post, ancestry: comment.ancestry ? "#{comment.ancestry}/#{comment.id}" : comment.id)

  - if comment.has_children?
    - comment.children.each do |nested_comment|
      div(style="margin-left: #{indent * 2}rem; width: calc(100% - #{indent * 2}rem)")
        == render 'posts/comments/nested', comment: nested_comment, post:, indent: indent + 1 > 6 ? indent : indent + 1
